<!DOCTYPE html>
<html lang="en">

  <head>
    <meta http-equiv="refresh" content="3; url=https://materials-science.github.io//" />
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Materials Computation & Modeling


  | FourPhonon

</title>
<meta name="description" content="Materials Computation & Modeling Group of Shenzhen University - leading by Prof. Li Wu.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://cdn.staticfile.org/bootstrap/4.5.3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.19.1/css/mdb.min.css"/>

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdn.staticfile.org/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<!-- <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> -->

<!-- Code Syntax Highlighting -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" /> -->

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî¨</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="https://materials-science.github.io/projects/FourPhonon/">


<!-- Dark Mode -->
<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>


  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://materials-science.github.io//">
       Materials Computation &amp; Modeling
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                Projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/to-wtt2022">
                WTT2022
                
              </a>
          </li>
          
          
          
          
          
          
            <div class="toggle-container">
              <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      


<div class="post">

  <header class="post-header">
    <h1 class="post-title">FourPhonon</h1>
    <p class="post-description">An extension module to ShengBTE for computing four-phonon scattering rates and thermal conductivity.</p>
    
  </header>

  <article>
    <h1 id="fourthorder">Fourthorder</h1>

<p>Zherui Han <a href="mailto:zrhan@purdue.edu">zrhan@purdue.edu</a>
Xiaolong Yang <a href="mailto:xiaolongyang1990@gmail.com">xiaolongyang1990@gmail.com</a>
Wu Li <a href="mailto:wu.li.phys2011@gmail.com">wu.li.phys2011@gmail.com</a>
Tianli Feng <a href="mailto:Tianli.Feng2011@gmail.com">Tianli.Feng2011@gmail.com</a>
Xiulin Ruan <a href="mailto:ruan@purdue.edu">ruan@purdue.edu</a></p>

<p>The Fourthorder scripts were derived from the thirdorder scripts, which are used to help users of [ShengBTE containing four-phonon modules] create FORCE_CONSTANTS_4TH files in an efficient and convenient manner. More specifically, it performs two tasks:</p>

<ol>
  <li>
    <p>It resolves an irreducible set of atomic displacements from which to compute the full anharmonic fourth-order interatomic force constant (IFC) matrix. The displaced supercells are saved to input files that can be fed to first-principles DFT codes for calculating the forces arising from the atomic displacements. Currently supported DFT codes are VASP (Fourthorder_vasp.py), and Quantum ESPRESSO (Fourthorder_espresso.py).</p>
  </li>
  <li>
    <p>From the output files created by the DFT code, Fourthorder reconstructs the full fourth-order IFC matrix and writes it in the right format to FORCE_CONSTANTS_4TH.</p>
  </li>
</ol>

<h1 id="compilation">Compilation</h1>

<p>Fourthorder is a set of Python scripts. It was developed using Python 2.7.3, but should work with slightly older versions. In addition to the modules in Python‚Äôs standard library, the numpy and scipy numerical libraries are required. Moreover, this script relies on a module, Fourthorder_core, which is written in Cython. Thus, in spite of Python being an interpreted language, a compilation step is needed. Note that in addition to the .pyx source we also distribute the intermediate .c file, so Cython itself is not needed. The only requirements are a C compiler, the Python development package and Atsushi Togo‚Äôs <a href="http://spglib.sourceforge.net/" target="_blank" rel="noopener noreferrer">spglib</a>.</p>

<p>Compiling can be as easy as running</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./compile.sh
</code></pre></div></div>

<p>However, if you have installed spglib to a nonstandard directory, you will have to perform some simple editing on setup.py so that the compiler can find it. Please refer to the comments in that file.</p>

<h1 id="usage">Usage</h1>

<p>After a successful compilation, the directory will contain the compiled module Fourthorder_core.so, Fourthorder_common.py and DFT-code specific interfaces (e.g. Fourthorder_vasp.py). All are needed to run Fourthorder. You can either use them from that directory (maybe including it in your PATH for convenience) or copying the .py files to a directory in your PATH and Fourthorder_core.so to any location where Python can find it for importing.</p>

<h1 id="running-fourthorder-with-vasp">Running Fourthorder with VASP</h1>

<p>Any invocation of Fourthorder_vasp.py requires a POSCAR file with a description of the unit cell to be present in the current directory. The script uses no other configuration files, and takes exactly five mandatory command-line arguments:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fourthorder_vasp.py sow|reap na nb nc cutoff[nm/-integer]
</code></pre></div></div>

<p>The first argument must be either ‚Äúsow‚Äù or ‚Äúreap‚Äù, and chooses the operation to be performed (displacement generation or IFC matrix reconstruction). The next three must be positive integers, and specify the dimensions of the supercell to be created. Finally, the ‚Äúcutoff‚Äù parameter decides on a force cutoff distance. Interactions between atoms spaced further than this parameter are neglected. If cutoff is a positive real number, it is interpreted as a distance in nm; on the other hand, if it is a negative integer -n, the maximum distance among n-th neighbors in the supercell is automatically determined and the cutoff distance is set accordingly.</p>

<p>The following POSCAR describes the relaxed geometry of the primitive unit cell of InAs, a III-V semiconductor with a zincblende structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>InAs
   6.00000000000000
     0.0000000000000000    0.5026468896190005    0.5026468896190005
     0.5026468896190005    0.0000000000000000    0.5026468896190005
     0.5026468896190005    0.5026468896190005    0.0000000000000000
   In   As
   1   1
Direct
  0.0000000000000000  0.0000000000000000  0.0000000000000000
  0.2500000000000000  0.2500000000000000  0.2500000000000000
</code></pre></div></div>

<p>Let us assume that such POSCAR is in the current directory and that Fourthorder_vasp.py is in our PATH. To generate an irreducible set of displacements for a 4x4x4 supercell and up-to-second-neighbor interactions, we run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fourthorder_vasp.py sow 4 4 4 <span class="nt">-2</span>
</code></pre></div></div>

<p>This creates a file called 4TH.SPOSCAR with the undisplaced supercell coordinates and 744 files with names following the pattern 4TH.POSCAR.*. It is the latter that need to be input to VASP. This step is completely system-dependent, but suppose that in ~/vaspinputs we have the required INCAR, POTCAR and KPOINTS files as well as a runvasp.sh script that can be passed to qsub. We can run a command sequence like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in </span>4TH.POSCAR.<span class="k">*</span><span class="p">;</span><span class="k">do
   </span><span class="nv">s</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$i</span>|cut <span class="nt">-d</span><span class="s2">"."</span> <span class="nt">-f3</span><span class="si">)</span> <span class="o">&amp;&amp;</span>
   <span class="nv">d</span><span class="o">=</span>job-<span class="nv">$s</span> <span class="o">&amp;&amp;</span>
   <span class="nb">mkdir</span> <span class="nv">$d</span> <span class="o">&amp;&amp;</span>
   <span class="nb">cp</span> <span class="nv">$i</span> <span class="nv">$d</span>/POSCAR <span class="o">&amp;&amp;</span>
   <span class="nb">cp</span> ~/vaspinputs/INCAR ~/vaspinputs/POTCAR ~/vaspinputs/KPOINTS <span class="nv">$d</span> <span class="o">&amp;&amp;</span>
   <span class="nb">cp</span> ~/vaspinputs/runvasp.sh <span class="nv">$d</span> <span class="o">&amp;&amp;</span>
   <span class="o">(</span><span class="nb">cd</span> <span class="nv">$d</span> <span class="o">&amp;&amp;</span> qsub runvasp.sh<span class="o">)</span>
<span class="k">done</span>
</code></pre></div></div>

<p>Some time later, after all these jobs have finished successfully, we only need to feed all the vasprun.xml files in the right order to Fourthorder_vasp.py, this time in reap mode:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find job<span class="k">*</span> <span class="nt">-name</span> vasprun.xml|sort <span class="nt">-n</span>|Fourthorder_vasp.py reap 4 4 4 <span class="nt">-2</span>
</code></pre></div></div>

<p>If everything goes according to plan, a FORCE_CONSTANTS_4TH file will be created at the end of this run. Naturally, it is important to choose the same parameters for the sow and reap steps.</p>

<h1 id="running-fourthorder-with-quantum-espresso">Running Fourthorder with Quantum ESPRESSO</h1>

<p>The invocation of Fourthorder_espresso.py requires two files:</p>

<ol>
  <li>
    <p>an input file of the unit cell with converged structural parameters</p>
  </li>
  <li>
    <p>a template input file for the supercell calculations. The template file is a normal QE input file with some wildcards</p>
  </li>
</ol>

<p>The following input file GaAs.in describes the relaxed geometry of the primitive unit cell of GaAs, a III-V semiconductor with a zincblende structure</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp;CONTROL
 calculation='scf',
 prefix='gaas',
 restart_mode='from_scratch',
 tstress = .true.,
 tprnfor = .true.,
/
&amp;SYSTEM
 ibrav=0,
 nat=2,
 ntyp=2,
 ecutwfc=48
 ecutrho=384
/
&amp;ELECTRONS
 conv_thr=1.d-12,
/
ATOMIC_SPECIES
 Ga  69.723    Ga.pbe-dnl-kjpaw_psl.1.0.0.UPF
 As  74.92160  As.pbe-dn-kjpaw_psl.1.0.0.UPF
ATOMIC_POSITIONS crystal
 Ga 0.00 0.00 0.00
 As 0.25 0.25 0.25
K_POINTS automatic
11 11 11 0 0 0
CELL_PARAMETERS angstrom
   0.000000000   2.857507756   2.857507756
   2.857507756   0.000000000   2.857507756
   2.857507756   2.857507756   0.000000000
</code></pre></div></div>

<p>Fourthorder_espresso.py supports the following QE input conventions for structural parameters:</p>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>ibrav = 0 together with CELL_PARAMETERS (alat</td>
          <td>bohr</td>
          <td>angstrom)</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>ibrav != 0 together with celldm(1)-celldm(6)</li>
</ol>

<table>
  <tbody>
    <tr>
      <td>For ATOMIC_POSITIONS, all QE units are supported (alat</td>
      <td>bohr</td>
      <td>angstrom</td>
      <td>crystal). Simple algebraic expressions for the positions are supported in similar fashion to QE. Cases ibrav = -5, -9, -12, -13, and 91 are not currently implemented (but those structures can be defined via ibrav = 0 instead)</td>
    </tr>
  </tbody>
</table>

<p>The following supercell template GaAs_sc.in is used for creating the supercell input files (note the ##WILDCARDS##):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp;CONTROL
  calculation='scf',
  prefix='gaas',
  tstress = .true.,
  tprnfor = .true.,
  outdir = 'tmp_##NUMBER##'
/
&amp;SYSTEM
  ibrav=0,
  nat=##NATOMS##,
  ntyp=2,
  ecutwfc=48
  ecutrho=384
/
&amp;ELECTRONS
  conv_thr=1.d-12,
/
ATOMIC_SPECIES
 As  74.92160  As.pbe-dn-kjpaw_psl.1.0.0.UPF
 Ga  69.723    Ga.pbe-dnl-kjpaw_psl.1.0.0.UPF
##COORDINATES##
K_POINTS gamma
##CELL##
</code></pre></div></div>

<p>Please note that if Gamma-point k-sampling is used for the supercells, it is computationally much more efficient to apply ‚ÄúK_POINTS gamma‚Äù instead of ‚ÄúK_POINTS automatic‚Äù with the mesh set to ‚Äú1 1 1 0 0 0‚Äù. SCF convergence criterion conv_thr should be set to a tight value and parameters tstress and tprnfor are required so that Fourthorder can extract the forces from the output file.</p>

<p>Fourthorder uses no other configuration files, and requires seven mandatory command-line arguments to create the supercell inputs with the ‚Äúsow‚Äù operation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fourthorder_espresso.py unitcell.in sow na nb nc cutoff[nm/-integer] supercell_template.in
</code></pre></div></div>

<p>Please see the above description for VASP for the explanation of the parameters na, nb, nc, and cutoff. For the present GaAs example, we execute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fourthorder_espresso.py GaAs.in sow 4 4 4 <span class="nt">-2</span> GaAs_sc.in
</code></pre></div></div>

<p>The command creates a file called BASE.GaAs_sc.in with the undisplaced supercell coordinates and 744 files with names following the pattern DISP.GaAs_sc.in.NNN The DISP files should be executed with QE. This step is completely system-dependent, but some practical suggestions can be extracted from the VASP example above.</p>

<p>After all the jobs have finished successfully, we only need to feed all the output files in the right order to Fourthorder_espresso.py, this time in reap mode (now using only six arguments, the supercell argument is not used here):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find <span class="nb">.</span> <span class="nt">-name</span> <span class="s1">'DISP.GaAs_sc.in*out'</span> | <span class="nb">sort</span> <span class="nt">-n</span> | Fourthorder_espresso.py GaAs.in reap 4 4 4 <span class="nt">-2</span>
</code></pre></div></div>

<p>If everything goes according to plan, a FORCE_CONSTANTS_4TH file will be created at the end of this run. Naturally, it is important to choose the same parameters for the sow and reap steps.</p>

  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    ¬© Copyright 2022   .
    Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Maintained by <a href="https://github.com/PorYoung/" target="_blank" rel="noopener noreferrer">PorYoung</a>.

    
    
    Last updated: June 24, 2022.
    
  </div>
</footer>



  </body>

  <script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script>

  
<!-- Bootsrap & MDB scripts -->
<script src="https://cdn.bootcdn.net/ajax/libs/popper.js/2.4.4/umd/popper.min.js"></script>
<script src="https://cdn.staticfile.org/bootstrap/4.5.3/js/bootstrap.min.js"></script>
<script src="https://cdn.staticfile.org/mdbootstrap/4.19.1/js/mdb.min.js"></script>


  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  
<!-- Enable Tooltips -->
<script type="text/javascript">
$(function () {$('[data-toggle="tooltip"]').tooltip()})
</script>



<!-- Medium Zoom JS -->

<script defer type="text/javascript" id="MathJax-script" src="https://cdn.staticfile.org/medium-zoom/1.0.6/medium-zoom.min.js"></script>


<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

  
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>


<script defer type="text/javascript" id="MathJax-script" src="https://cdn.staticfile.org/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>


<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  





</html>
